#!/usr/bin/env bash

set -e

FWDIR="$(cd `dirname $0`/..; pwd)"

export PIO_HOME="$FWDIR"

. $FWDIR/bin/load-pio-env.sh

SBT=sbt

if [ -x $FWDIR/sbt/sbt ]; then
  SBT=$FWDIR/sbt/sbt
fi

if [ -z "$1" ]; then
  echo "Usage: register-engine <engine-manifest.json>" 1>&2
  exit 1
fi

if [ ! -f target/scala*/*-assembly-*-deps.jar ]; then
  $SBT assemblyPackageDependency
fi

$SBT package

exec $PIO_HOME/bin/pio-class io.prediction.tools.RegisterEngine $@ target/scala*/*.jar

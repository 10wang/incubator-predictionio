#!/usr/bin/env bash

set -e

export PIO_HOME="$(cd `dirname $0`/..; pwd)"

ASSEMBLY_DIR="$PIO_HOME/assembly"

if [ -f "$PIO_HOME/RELEASE" ]; then
  assembly_folder="$FWDIR"/lib
else
  assembly_folder="$ASSEMBLY_DIR"
fi

ASSEMBLY_JAR=$(ls "$assembly_folder"/tools-assembly*.jar 2>&-)

$PIO_HOME/bin/pio-class io.prediction.tools.RunWorkflow --core $ASSEMBLY_JAR "$@"

if hash supervisorctl 2>&-; then
  echo "Found supervisorctl. Trying to restart prediction server..."
  supervisorctl restart pio
fi
